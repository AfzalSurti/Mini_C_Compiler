<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mini C Online Runner</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; }
    header { padding: 12px 16px; border-bottom: 1px solid #ddd; }
    .wrap { display: grid; grid-template-columns: 1fr 1fr; height: calc(100vh - 80px); }
    textarea { width: 100%; height: 100%; font-family: monospace; font-size: 14px; padding: 12px; border: 0; outline: none; }
    .panel { border-left: 1px solid #ddd; padding: 12px; overflow: auto; }
    .row { display: flex; gap: 10px; align-items: center; }
    button { padding: 8px 12px; cursor: pointer; }
    pre { background: #111; color: #0f0; padding: 10px; overflow:auto; }
    .err { color: #ff4d4d; background: #1a1a1a; }
    .ok  { color: #00ff88; }
    small { color: #555; }
  </style>
</head>
<body>
  <header>
    <div class="row">
      <strong>Mini C Online Compiler</strong>
      <select id="mode">
        <option value="irvm">Run (IRVM - safe)</option>
        <option value="native">Run (Native - clang)</option>
      </select>
      <button onclick="run()">Run</button>
    </div>
    <small>
      Supported: <b>int</b>, <b>+ - * /</b>, <b>print(expr);</b>, parentheses.
      Not supported: if/while/functions/strings.
    </small>
  </header>

  <div class="wrap">
    <textarea id="code">
int a = 5 + 3 * 2;
print(a);
    </textarea>

    <div class="panel">
      <h3>Output</h3>
      <pre id="out"></pre>

      <h3>Errors</h3>
      <pre id="err" class="err"></pre>

      <details>
        <summary>Show IR / LLVM (debug)</summary>
        <h4>Optimized IR</h4>
        <pre id="ir"></pre>
        <h4>LLVM IR</h4>
        <pre id="llvm"></pre>
      </details>
    </div>
  </div>

<script>
async function run(){
  const code = document.getElementById("code").value;
  const mode = document.getElementById("mode").value;

  document.getElementById("out").textContent = "Running...";
  document.getElementById("err").textContent = "";
  document.getElementById("ir").textContent = "";
  document.getElementById("llvm").textContent = "";

  const res = await fetch("/api/run", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({code, mode})
  });

  const data = await res.json();

  document.getElementById("out").textContent = data.stdout || "";
  document.getElementById("err").textContent = data.ok ? "" : (data.stderr || "Unknown error");
  document.getElementById("ir").textContent = JSON.stringify(data.optimized_ir || [], null, 2);
  document.getElementById("llvm").textContent = data.llvm || "";
}
</script>
</body>
</html>