<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mini C Online Runner</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap');

    :root {
      --bg-1: #0b0f14;
      --bg-2: #0f1722;
      --ink: #e6edf3;
      --muted: #9aa7b5;
      --accent: #ffb703;
      --accent-2: #00d4ff;
      --card: #141b25;
      --card-2: #0f1621;
      --stroke: rgba(255, 255, 255, 0.08);
      --good: #30f2a2;
      --bad: #ff6b6b;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--ink);
      font-family: "Space Grotesk", sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -20%, rgba(0, 212, 255, 0.22), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(255, 183, 3, 0.22), transparent 55%),
        linear-gradient(160deg, var(--bg-1), var(--bg-2));
      min-height: 100vh;
    }

    header {
      padding: 28px 36px 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .brand-badge {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: linear-gradient(145deg, var(--accent), #ff7a00);
      box-shadow: 0 10px 30px rgba(255, 183, 3, 0.35);
    }

    .title {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 0.4px;
    }

    .subtitle {
      color: var(--muted);
      margin-top: 6px;
      font-size: 14px;
    }

    .toolbar {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .pill {
      background: rgba(0, 212, 255, 0.15);
      color: #b7f6ff;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0, 212, 255, 0.3);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    select, button {
      font-family: inherit;
      border-radius: 10px;
      border: 1px solid var(--stroke);
      background: rgba(20, 27, 37, 0.8);
      color: var(--ink);
      padding: 10px 14px;
      font-size: 14px;
    }

    button {
      background: linear-gradient(135deg, #2bffd1, #00d4ff);
      color: #0a0f14;
      font-weight: 700;
      box-shadow: 0 12px 24px rgba(0, 212, 255, 0.2);
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    button:hover { transform: translateY(-1px); box-shadow: 0 16px 30px rgba(0, 212, 255, 0.32); }

    .wrap {
      display: grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 18px;
      padding: 0 36px 32px;
    }

    .card {
      background: linear-gradient(160deg, rgba(20, 27, 37, 0.9), rgba(13, 20, 30, 0.9));
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.35);
      overflow: hidden;
    }

    .card-header {
      padding: 16px 18px;
      border-bottom: 1px solid var(--stroke);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      color: #d8e3ef;
    }

    textarea {
      width: 100%;
      height: 100%;
      min-height: 460px;
      font-family: "IBM Plex Mono", monospace;
      font-size: 14px;
      padding: 18px;
      background: transparent;
      color: var(--ink);
      border: 0;
      outline: none;
      line-height: 1.55;
      resize: vertical;
    }

    .panel {
      padding: 16px 18px 20px;
      display: grid;
      gap: 14px;
    }

    .label {
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.8px;
      text-transform: uppercase;
    }

    pre {
      margin: 0;
      padding: 14px;
      font-family: "IBM Plex Mono", monospace;
      font-size: 13px;
      border-radius: 12px;
      background: var(--card-2);
      border: 1px solid var(--stroke);
      color: #cfe7ff;
      overflow: auto;
      max-height: 240px;
    }

    .err { color: var(--bad); border-color: rgba(255, 107, 107, 0.35); }
    .ok  { color: var(--good); }

    details {
      border: 1px dashed rgba(255, 255, 255, 0.14);
      border-radius: 12px;
      padding: 10px 12px;
      color: var(--muted);
    }

    summary {
      cursor: pointer;
      font-weight: 600;
    }

    .tips {
      color: var(--muted);
      font-size: 13px;
      padding: 0 36px 24px;
    }

    @media (max-width: 960px) {
      .wrap { grid-template-columns: 1fr; }
      header { padding: 24px; }
      .tips { padding: 0 24px 24px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="brand-badge" aria-hidden="true"></div>
      <div>
        <div class="title">Mini C Online Compiler</div>
        <div class="subtitle">From code to IR to execution, instantly.</div>
      </div>
    </div>
    <div class="toolbar">
      <span class="pill">IRVM ready</span>
      <label class="label" for="mode">Run mode</label>
      <select id="mode" aria-label="Run mode">
        <option value="irvm">Run (IRVM - safe)</option>
        <option value="native">Run (Native - clang)</option>
      </select>
      <button onclick="run()">Run program</button>
      <span class="label">Backend: http://127.0.0.1:8000</span>
    </div>
  </header>

  <div class="wrap">
    <section class="card">
      <div class="card-header">
        <div class="card-title">Editor</div>
        <div class="label">Mini C source</div>
      </div>
      <textarea id="code" aria-label="Mini C code">
int a = 5 + 3 * 2;
print(a);
      </textarea>
    </section>

    <section class="card">
      <div class="card-header">
        <div class="card-title">Execution</div>
        <div class="label">Results and diagnostics</div>
      </div>
      <div class="panel">
        <div class="label">Output</div>
        <pre id="out"></pre>

        <div class="label">Errors</div>
        <pre id="err" class="err"></pre>

        <details>
          <summary>Show IR / LLVM (debug)</summary>
          <div class="label">Optimized IR</div>
          <pre id="ir"></pre>
          <div class="label">LLVM IR</div>
          <pre id="llvm"></pre>
        </details>
      </div>
    </section>
  </div>

  <div class="tips">
    Supported: int, float, double, string, arrays, + - * /, print(expr); parentheses. Not supported: if/while/functions.
  </div>

<script>
const API_BASE = "http://127.0.0.1:8000";

async function run(){
  const code = document.getElementById("code").value;
  const mode = document.getElementById("mode").value;

  document.getElementById("out").textContent = "Running...";
  document.getElementById("err").textContent = "";
  document.getElementById("ir").textContent = "";
  document.getElementById("llvm").textContent = "";

  try {
    const res = await fetch(`${API_BASE}/api/run`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({code, mode})
    });

    let data = null;
    try {
      data = await res.json();
    } catch {
      data = {
        ok: false,
        stderr: `HTTP ${res.status}: Invalid JSON response. Make sure backend is running on ${API_BASE}.`
      };
    }

    if (!res.ok) {
      throw new Error(data.stderr || `HTTP ${res.status}`);
    }

    document.getElementById("out").textContent = data.stdout || "";
    document.getElementById("err").textContent = data.ok ? "" : (`[${data.phase || "error"}] ${data.stderr || "Unknown error"}`);
    document.getElementById("ir").textContent = JSON.stringify(data.optimized_ir || [], null, 2);
    document.getElementById("llvm").textContent = data.llvm || "";
  } catch (error) {
    document.getElementById("out").textContent = "";
    document.getElementById("err").textContent = `Request failed: ${error.message}`;
  }
}
</script>
</body>
</html>